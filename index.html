<!DOCTYPE html>
<html>
<head>
    <title>弹幕网络可视化</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        #sigma-container {
            width: 100%;
            height: 100vh;
            background-color: #ffffff;
        }
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        #loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 20px;
            color: #666;
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #error {
            position: fixed;
            top: 10px;
            left: 10px;
            color: red;
            display: none;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #controls {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            margin: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
    </style>
    <!-- 引入 Sigma.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/sigma.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.parsers.json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sigma.js/1.2.1/plugins/sigma.renderers.edgeLabels.min.js"></script>
</head>
<body>
    <div id="loading">正在加载网络数据...</div>
    <div id="error"></div>
    <div id="controls">
        <button onclick="resetZoom()">重置视图</button>
        <button onclick="toggleLabels()">显示/隐藏标签</button>
    </div>
    <div id="sigma-container"></div>
    <script>
        let sigma;
        let labelsVisible = true;

        // 显示错误信息
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        // 重置缩放
        function resetZoom() {
            sigma.camera.goTo({
                x: 0,
                y: 0,
                ratio: 1
            });
        }

        // 切换标签显示
        function toggleLabels() {
            labelsVisible = !labelsVisible;
            sigma.settings('labelThreshold', labelsVisible ? 6 : 1000);
            sigma.refresh();
        }

        // 初始化 Sigma
        sigma = new Sigma({
            graph: {
                nodes: [],
                edges: []
            },
            container: 'sigma-container',
            settings: {
                defaultNodeColor: '#ec5148',
                defaultEdgeColor: '#666',
                labelThreshold: 6,
                labelSize: 'proportional',
                labelSizeRatio: 1.6,
                edgeLabelSize: 'proportional',
                edgeLabelThreshold: 6,
                edgeLabelSizeRatio: 0.8,
                minNodeSize: 1,
                maxNodeSize: 20,
                minEdgeSize: 0.2,
                maxEdgeSize: 2,
                enableEdgeHovering: true,
                edgeHoverColor: 'edge',
                defaultEdgeHoverColor: '#000',
                edgeHoverSizeRatio: 1,
                edgeHoverExtremities: true
            }
        });

        // 加载数据
        fetch('network_data.json')
            .then(response => response.json())
            .then(data => {
                // 添加节点
                data.nodes.forEach(node => {
                    sigma.graph.addNode({
                        id: node.id,
                        label: node.label,
                        size: node.size,
                        x: Math.random(),
                        y: Math.random()
                    });
                });

                // 添加边
                data.edges.forEach(edge => {
                    sigma.graph.addEdge({
                        id: edge.id,
                        source: edge.source,
                        target: edge.target,
                        size: edge.size
                    });
                });

                // 隐藏加载提示
                document.getElementById('loading').style.display = 'none';
                
                // 刷新显示
                sigma.refresh();
            })
            .catch(error => {
                console.error('Error loading the network:', error);
                showError('加载网络数据失败: ' + error.message);
                document.getElementById('loading').style.display = 'none';
            });
    </script>
</body>
</html> 